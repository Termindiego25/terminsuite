# ================================================
# TerminSuite - Unbound configuration
# ================================================
# This file is mounted into the container at:
#   /opt/unbound/etc/unbound/unbound.conf
#
# Purpose:
#  - Hardened recursive resolver for Pi-hole
#  - DNSSEC validation and qname-minimisation enabled
# ================================================

server:
  # Listen on all interfaces inside the container
  interface: 0.0.0.0
  port: 5335

  # Hardening & privacy
  hide-identity: yes          # hide unbound identity
  hide-version: yes           # hide version string
  harden-glue: yes
  harden-dnssec-stripped: yes
  harden-referral-path: yes
  qname-minimisation: yes
  aggressive-nsec: yes
  harden-below-nxdomain: yes

  # Prevent large responses on networks with small MTU
  edns-buffer-size: 1232

  # DNSSEC
  # The trust anchor file is managed in the container var dir:
  # /opt/unbound/etc/unbound/var/root.key
  auto-trust-anchor-file: "/opt/unbound/etc/unbound/var/root.key"
  val-permissive-mode: no
  val-clean-additional: yes

  # Caching / performance
  cache-min-ttl: 60
  cache-max-ttl: 86400
  msg-cache-size: 64m
  rrset-cache-size: 128m
  neg-cache-size: 4m
  prefetch: yes
  prefetch-key: yes

  # Networking
  do-ip4: yes
  do-ip6: yes
  prefer-ip6: no

  # Root hints file (must be kept reasonably up-to-date)
  # Repository path: ./unbound/root.hints
  root-hints: "/opt/unbound/etc/unbound/root.hints"

  # Concurrency / socket options
  so-reuseport: yes
  minimal-responses: yes
  unwanted-reply-threshold: 10000000

  # Logging: operational default is low verbosity; increase only for debugging
  verbosity: 2

  # Access control: restrict which networks can query this resolver.
  # Adjust the CIDR lists to match your local networks and Docker subnets.
  access-control: 127.0.0.1/32 allow
  access-control: 172.16.0.0/12 allow # Docker network